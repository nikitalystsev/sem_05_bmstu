\chapter{Теория проектирования реляционных баз данных: функциональные зависимости, нормальные формы}

Классический подход к проектированию реляционных баз данных заключается в том, что сначала предметная область представляется в виде одного или нескольких отношений, а далее осуществляется процесс \textit{нормализации} схем отношений.

Каждой нормальной форме соответствует некоторый определенный набор ограничений, и отношение находится в некоторой нормальной форме, если удовлетворяет свойственному ей набору ограничений. 

В теории реляционных баз данных обычно выделяется следующая последовательность нормальных форм:

\begin{itemize}[label*=--]
	\item первая нормальная форма (1НФ или 1NF);
	\item вторая нормальная форма (2НФ или 2NF);
	\item третья нормальная форма (3НФ или 3NF);
	\item нормальная форма Бойса-Кодда (НФБК или BCNF);
	\item четвертая нормальная форма (4НФ или 4NF);
	\item пятая нормальная форма, или нормальная форма проекции-соединения (5НФ или 5NF или PJ/NF).
\end{itemize}

Основные свойства нормальных форм такие:

\begin{itemize}[label*=--]
	\item каждая следующая нормальная форма в некотором смысле лучше предыдущей;
	\item при переходе к следующей нормальной форме свойства предыдущих нормальных свойств сохраняются.
\end{itemize}

\clearpage

Процесс проектирования реляционной базы данных на основе метода нормализации преследует две основные цели:

\begin{itemize}[label*=--]
	\item избежать избыточности хранения данных;
	\item устранить аномалии обновления отношений.
\end{itemize}


В основе метода нормализации лежит \textit{декомпозиция} отношения, находящегося в предыдущей нормальной форме, в два или более отношения, удовлетворяющих требованиям следующей нормальной формы. 
Считаются правильными такие декомпозиции отношения, которые обратимы, т.~е. имеется возможность собрать исходное отношение из декомпозированных отношений без потери информации.

Наиболее важные на практике нормальные формы отношений основываются на фундаментальном в теории реляционных баз данных понятии функциональной зависимости.


\section{Функциональные зависимости}

\textbf{Определение 1.} 
Пусть R --- это отношение, а Х и Y --- произвольные подмножества множества атрибутов отношения R. Тогда Y \textit{\bfseries функционально зависимо} от Х, что в символическом виде записывается как X -> Y $\Leftrightarrow \forall$ значение множества Х связано в точности с одним значением множества Y.

Левая и правая стороны ФЗ будут называются \textit{\bfseries детерминантом} и \textit{\bfseries зависимой частью} соответственно.

\textbf{Определение 2.} Пусть R является переменной-отношением, а Х и Y --- произвольными подмножествами множества атрибутов переменной-отношения R. Тогда Х -> Y $\Leftrightarrow \forall$ \textit{\bfseries допустимого значения отношения} R $\forall$ значение Х связано в точности с одним значением Y.

\textbf{Определение 2a.} Пусть R(A1, A2, $\ldots$, An) --- схема отношения. Функциональная зависимость, обозначаемая X -> Y между двумя наборами атрибутов X и Y, которые являются подмножествами R определяет ограничение на возможность существования кортежа в некотором отношении r. Ограничение означает, что для любых двух кортежей $t_1$ и $t_2$ в r, для которых имеет место $t_1$[X] = $t_2$[X], также имеет место $t_1$[Y] = $t_2$[Y].


\begin{itemize}[label*=--]
	\item Если ограничение на схеме отношения R утверждает, что не может быть более одного кортежа со значением атрибутов X в любом отношении экземпляре отношения r, то X является потенциальным ключом R. 
	Это означает, что X -> Y для любого подмножества атрибутов Y из R. 
	Если X является потенциальным ключ R, то X -> R.
	\item Если X -> Y в R, это не означает, что Y -> X в R.
\end{itemize}

Функциональная зависимость является семантическим свойством, т.~е. свойством значения атрибутов.

\textbf{Определение 3.} ФЗ (X -> Y) тривиальная $\Leftrightarrow$ Y $\subseteq$ X.

\textbf{Определение 4.} Множество всех ФЗ, которые задаются данным множеством ФЗ S, называется замыканием S и обозначается символом S+.

Пусть в перечисленных ниже правилах А, В и C – произвольные подмножества множества атрибутов заданной переменной-отношения R, а символическая запись АВ означает \{ A, B \}. 
Тогда правила вывода определяются следующим образом:

\begin{enumerate}[label={\arabic*)}]
	\item  Правило \textit{\bfseries рефлексивности}: (B $\subseteq$ A) $\Rightarrow$ (А -> В).
	\item  Правило \textit{\bfseries дополнения}: (A -> B) $\Rightarrow$ АС -> BC.
	\item  Правило \textit{\bfseries транзитивности}: (А -> В) и (В -> С) $\Rightarrow$ (А -> C).
	\item  Правило \textit{\bfseries самоопределения}: А -> А.
	\item  Правило \textit{\bfseries декомпозиции}: (A -> BC) $\Rightarrow$ (А -> В) и (А -> С).
	\item  Правило \textit{\bfseries объединения}: (А -> В) и (А -> С) $\Rightarrow$ (А -> BC). 
	\item  Правило \textit{\bfseries композиции}: (А -> В) и (С -> D) $\Rightarrow$ (АС -> BD).
	\item  \textit{\bfseries Общая теорема объединения}: (А -> В) и(С -> D) $\Rightarrow$ (А(С – B) -> BD).
\end{enumerate}

\clearpage

\textbf{Определение 5.} \textit{Суперключ} переменной-отношения R --- это множество атрибутов переменной-отношения R, которое содержит в виде подмножества (но не обязательно собственного подмножества), по крайней мере, один потенциальный ключ.

\textbf{Определение 6.} Два множества ФЗ S1 и S2 \textit{\bfseries эквивалентны} $\Leftrightarrow$ они \textit{\bfseries являются покрытиями} друг для друга, т. е. S1+ = S2+.

Каждое множество ФЗ эквивалентно, по крайней мере, одному \textit{\bfseries неприводимому} множеству.

\textbf{Определение 7.} Множество ФЗ является \textit{\bfseries неприводимым}  $\Leftrightarrow$ оно обладает всеми перечисленными ниже свойствами.

\begin{itemize}[label*=--]
	\item Каждая ФЗ этого множества имеет одноэлементную правую часть.
	\item Ни одна ФЗ множества не может быть устранена без изменения замыкания этого множества.
	\item Ни один атрибут не может быть устранен из левой части любой ФЗ данного множества без изменения замыкания множества.
\end{itemize}

Если I является неприводимым множеством, которое эквивалентно множеству S, то проверка выполнения ФЗ из множества I автоматически обеспечит выполнение ФЗ из множества S.

\section{Нормальные формы, основанные на функциональных зависимостях}

\textbf{Определение 1.} Переменная отношения находится в первой нормальной форме (1НФ) тогда и только тогда, когда в любом допустимом значении отношения каждый его кортеж содержит только одно значение для каждого из атрибутов.

\textbf{Определение 2.} Функциональная зависимость R.X -> R.Y называется полной, если атрибут Y не зависит функционально от любого точного подмножества X.

\textbf{Определение 3.} Функциональная зависимость R.X -> R.Y называется транзитивной, если существует такой атрибут Z, что имеются функциональные зависимости R.X -> R.Z и R.Z -> R.Y и отсутствует функциональная зависимость R.Z -> R.X. 
(При отсутствии последнего требования мы имели бы <<неинтересные>> транзитивные зависимости в любом отношении, обладающем несколькими ключами.)

\textbf{Определение 4.} Неключевым атрибутом называется любой атрибут отношения, не входящий в состав потенциального ключа (в частности, первичного).

\textbf{Определение 5.} Два или более атрибута взаимно независимы, если ни один из этих атрибутов не является функционально зависимым от других.

\subsection*{Вторая нормальная форма}

\textbf{Определение 6.} (В этом определении предполагается, что единственным ключом отношения является первичный ключ.) Отношение R находится во второй нормальной форме (2НФ) в том и только в том случае, когда оно находится в 1НФ, и каждый неключевой атрибут полностью зависит от первичного ключа.

Если допустить наличие нескольких ключей, то определение 6 примет следующий вид: 

\textbf{Определение 6a.} Отношение R находится во второй нормальной форме (2NF) в том и только в том случае, когда оно находится в 1НФ, и каждый неключевой атрибут полностью зависит от каждого ключа R.

\subsection*{Третья нормальная форма}

\textbf{Определение 7.} (Снова определение дается в предположении существования единственного ключа.) Отношение R находится в третьей нормальной форме (3НФ) в том и только в том случае, если оно находится в 2НФ и каждый неключевой атрибут нетранзитивно зависит от первичного ключа.

Если отказаться от того ограничения, что отношение обладает единственным ключом, то определение 3NF примет следующую форму: 

\textbf{Определение 7a.} Отношение R находится в третьей нормальной форме (3НФ) в том и только в том случае, если оно находится в 2НФ, и каждый неключевой атрибут не является транзитивно зависимым от какого-либо ключа R.

\subsection*{Нормальная форма Бойса-Кодда}

Определение 3НФ неадекватно при выполнении следующих условий:

\begin{enumerate}[label={\arabic*)}]
	\item  переменная-отношение имеет два (или более) потенциальных ключа;
	\item  эти потенциальные ключи являются составными;
	\item  два или более потенциальных ключей перекрываются (т. е. имеют по крайней мере один общий атрибут).
\end{enumerate}

Поэтому впоследствии исходное определение 3НФ было заменено более строгим определением нормальной формы Бойса-Кодда (НФБК).

\textbf{Определение 8.} Детерминант - любой атрибут (или группа атрибутов), от которого полностью функционально зависит некоторый другой атрибут.

\textbf{Определение 9.} Отношение R находится в нормальной форме Бойса-Кодда (НФБК) в том и только в том случае, если каждый детерминант является потенциальным ключом.

\subsection*{Многозначные зависимости и четвертая нормальная форма}

\textbf{Формальное определение МЗ.} 
Пусть A, B и C являются произвольными подмножествами множества атрибутов переменной-отношения R. 
Тогда подмножество B \textbf{многозначно зависит} от подмножества A, что символически выражается записью A -> > B $\Leftrightarrow$ множество значений B, соответствующее заданной паре (значение A, значение С) переменной-отношения R, зависит от A, но не зависит от С.

\textbf{Определение 4НФ.}  Переменная-отношение R находится в четвертой нормальной форме (4НФ) тогда и только тогда, когда в случае существования таких подмножеств А и B атрибутов этой переменной-отношения R, для которых выполняется нетривиальная МЗ А -> > B, все атрибуты переменной-отношения R также функционально зависят от атрибута А.

\subsection*{Зависимости соединения и пятая нормальная форма}

\textbf{Определение *зависимости соединения.} 
Пусть R является переменной-отношением, а А, В, $\ldots$, Z - произвольными под- множествами множества ее атрибутов. Переменная-отношение R удовлетворяет зависимости соединения *{ А, В, $\ldots$, Z} (читается <<звездочка А, В, $\ldots$, Z>>) тогда и только тогда, когда любое допустимое значение переменной-отношения R эквивалентно соединению ее проекций по подмножествам атрибутов А, В, $\ldots$, Z.

\textbf{Определение 5НФ.} Переменная-отношение R находится в пятой нормальной форме (5НФ), которую иногда иначе называют проекционно-соединительной нормальной формой (ПСНФ), тогда и только тогда, когда каждая нетривиальная ЗС в переменной-отношении R подразумевается ее потенциальными ключами.




\chapter{Реляционная модель данных: структурная, целостная, манипуляционная части. Реляционная алгебра. Исчисление кортежей}

Реляционная модель состоит из трех частей: \textit{структурной}, \textit{целостностной} и \textit{манипуляционной}.

\section{Структурная часть реляционной модели}

Структурная часть описывает, из каких объектов состоит реляционная модель. 
Основной структурой данных, используемой в реляционной модели, являются нормализованные <<n-арные>> отношения.

Основными понятиями структурной части реляционной модели являются:

\begin{enumerate}[label={\arabic*)}]
	\item \texttt{тип данных};
	\item \texttt{домен} --- рассматривается как подмножество значений некоторого типа данных, имеющих определенный смысл;
	\item \texttt{атрибут отношения} --- пара вида <имя\_атрибута, имя\_домена>. Имена атрибутов должны быть уникальны в
	пределах отношения. Часто имена атрибутов отношения совпадают с именами соответствующих доменов;
	\item \texttt{схема отношения} --- именованное множество упорядоченных пар <имя\_атрибута, имя\_домена>. \textit{Степенью} или
	<<\textit{арностью}>> схемы отношения является мощность этого множества;
	\item \texttt{схема базы данных} --- множество именованных схем отношений;
	\item \texttt{кортеж} --- множество упорядоченных пар <имя\_атрибута,
	значение\_атрибута>, которое содержит одно вхождение каждого имени атрибута, принадлежащего схеме отношения.
	Значение атрибута должно быть допустимым значением домена, на котором определен данный атрибут. 
	\textit{Степень} или <<\textit{арность}>> кортежа совпадает с <<\textit{арностью}>> соответствующей схемы отношения. 
	В реляционной модели каждый кортеж любого отношения должен отличатся от любого другого кортежа этого отношения (т.е. любое отношение должно обладать уникальным ключом);
	\item \texttt{отношение} определенное на множестве из n доменов (не обязательно различных), содержит две части: заголовок (схему отношения) и тело (множество из m кортежей). Значения n и m называются соответственно \textit{степенью} и \textit{кардинальностью} отношения;
	\item \texttt{потенциальный ключ} --- непустое подмножество множества атрибутов схемы отношения, обладающее свойствами \textit{уникальности} (в отношении нет двух различных кортежей с одинаковыми
	значениями потенциального ключа) и \textit{неизбыточности} (никакое из собственных подмножеств множества потенциального ключа не обладает свойством уникальности);
	\item \texttt{первичный ключ} --- один из выбранных потенциальных ключей. Остальные потенциальные ключи называются \texttt{альтернативными};
	\item \texttt{реляционная база данных} --- набор отношений, имена которых совпадают с именами схем отношений в схеме базы данных;
\end{enumerate}

\section{Целостная часть реляционной модели}

Фиксируются 2 базовых требования целостности, которые должны выполняться для любых отношений в любых реляционных базах данных --- \textit{целостность сущностей} и \textit{ссылочная целостность}.

Поддержание целостности сущностей обеспечивается средствами СУБД. 
Это осуществляется с помощью двух ограничений:

\begin{itemize}[label*=--]
	\item при добавлении записей в таблицу проверяется уникальность их первичных ключей;
	\item не позволяется изменение значений атрибутов, входящих в первичный ключ.
\end{itemize}

\clearpage

\textbf{Требования для ссылочной целостности (также на СУБД):} для каждого значения внешнего ключа, появляющегося в дочернем отношении, в родительском отношении должен найтись кортеж с таким же значением первичного ключа.

\section{Манипуляционная часть реляционной модели}

Oписывает два эквивалентных способа манипулирования реляционными данными — \textit{реляционную алгебру} и \textit{реляционное исчисление}. Реляционная алгебра в явном виде предоставляет набор операций, а реляционное исчисление представляет систему обозначений для определения требуемого отношения в терминах данных отношений.

\subsection*{Реляционная алгебра}

Реляционная алгебра является основным компонентом реляционной модели и состоит из 8-ми операторов, составляющих две группы по 4 оператора:

\begin{enumerate}[label={\arabic*)}]
	\item \texttt{Традиционные операции над множествами:} объединение (UNION), пересечение (INTERSECT), разность (MINUS) и декартово произведение (TIMES). Все операции модифицированы, с учетом того, что их операндами являются отношения, а не произвольные множества;
	\item \texttt{Специальные реляционные операции:} ограничение (WHERE), проекция (PROJECT), соединение (JOIN) и деление (DIVIDE BY).
\end{enumerate}

Результат выполнения любой операции реляционной алгебры над отношениями также является отношением --- свойство \textbf{реляционной замкнутости}.

Если рассматривать свойство реляционной замкнутости строго, то каждая реляционная операция должна быть определена таким образом, чтобы выдавать результат с надлежащим типом отношения (в частности, с соответствующим набором атрибутов или заголовком). 
Для достижения этой цели вводится новый оператор переименование (RENAME), предназначенный для переименования атрибутов в определенном отношении.

\clearpage

Упрощенный синтаксис выражений:

\begin{itemize}[label*=--]
	\item \texttt{реляционное\_выражение ::= \\ унарное\_выражение | бинарное\_выражение};
	\item \texttt{унарное\_выражение ::= переименование | ограничение | проекция};
	\item \texttt{переименование ::=терм RENAME имя\_атрибута AS имя\_атрибута}
	\item \texttt{терм ::= имя\_отношения | ( реляционное\_выражение )}
	\item \texttt{ограничение ::= терм WHERE логическое\_выражение}
	\item \texttt{проекция ::= терм | терм [ список\_имен\_атрибутов ]}
	\item \texttt{бинарное\_выражение ::= проекция | бинарная\_операция | реляционное\_выражение}
	\item \texttt{бинарная\_операция ::= UNION | INТERSECT | MINUS | TIМES | JOIN |  \\ DIVIDEBY}
\end{itemize}

Замечания: 

\begin{enumerate}[label={\arabic*)}]
	\item реляционные операторы UNION, INTERSECT и MINUS требуют, чтобы отношения были совместимыми по типу, т.~е. имели идентичные заголовки.
	\item реляционные операторы UNION, INTERSECT, TIMES и JOIN ассоциативны и коммутативны.
	\item если отношения A и B не имеют общих атрибутов, то операция соединения A JOIN B эквивалентна операции A TIMES B, т.~е. в таком случае соединение вырождается в декартово произведение. 
	Такое соединение называют естественным.
	\item  другой допустимый синтаксис для синтаксической категории переименования таков: (\texttt{терм RENAМE список\_переименований}). 
	Здесь каждый из элементов списка переименований представляет собой выражение \texttt{имя\_атрибута AS имя\_атрибута.}
	\item  Несмотря на большие возможности, предоставляемые операторами реляционной алгебры, существует несколько типов запросов, которые нельзя выразить этими средствами. 
	Для таких случаев необходимо использовать
	процедурные расширения реляционных языков.
\end{enumerate}

Дополнительные операторы реляционной алгебры: \textbf{SEMIJOIN} (полусоединение), \textbf{SEMIMINUS} (полувычитание), \textbf{EXTEND} (расширение), \textbf{SUMMARIZE} (обобщение), \textbf{TCLOSE} (транзитивное замыкание), \textbf{TRANSFORM}, \textbf{ROLLUP}, \textbf{CUBE}.

Синтаксис этих операторов выглядит следующим образом.

\begin{itemize}[label*=--]
	\item \texttt{<полусоединение> ::= <реляционное выражение> SEMIJOIN <реляционное выражение>};
	\item \texttt{<полувычитание> ::= <реляционное выражение> SEMIMINUS <реляционное выражение>};
	\item \texttt{<расширение> ::= EXTEND <реляционное выражение> ADD<список добавляемых расширений>}
	\item \texttt{<добавляемое расширение> ::= <выражение> AS <имя атрибута>}
	\item \texttt{<обобщение> ::= SUММARIZE <реляционное выражение> PER <реляционное выражение> ADD <список добавляемых обобщений>}
	\item \texttt{<добавляемое обобщение> ::= <тип обобщения> [ ( <скалярное выражение> ) ] AS <имя атрибута>}
	\item \texttt{<тип обобщения> ::= COUNT | SUM | AVG | МАХ | MIN | ALL | ANY | \\ COUNTD | SUMD | AVGD}
	\item \texttt{<транзитивное замыкание> ::= TCLOSE <реляционное выражение>}
\end{itemize}

\subsubsection*{Реляционные сравнения}

Реляционная алгебра в том виде, в котором она была изначально определена, не поддерживает прямого сравнения двух отношений (например, проверки их равенства или того, является ли одно из них подмножеством другого). Это упущение легко исправляется следующим образом. Сначала определяется новый вид условия - реляционное сравнение - со следующим синтаксисом.

\texttt{<реляционное выражение> <отношение> <реляционное выражение>} 

\texttt{<отношение> ::=
> --- Собственное супермножество, >= --- Супермножество, < --- Собственное подмножество, <= --- Подмножество, = --- Равно, <> --- Не равно}

\subsection*{Исчисление кортежей}

Реляционное исчисление является альтернативой реляционной алгебре. 
Внешне два подхода очень отличаются – исчисление описательное, а алгебра предписывающая, но на более низком уровне они представляют собой одно и то же, поскольку любые выражения исчисления могут быть преобразованы в семантически эквивалентные выражения в алгебре и наоборот.

Выражение исчисления кортежей содержит заключенный в скобки список целевых элементов и выражение WНERE, содержащее формулу WFF (<<правильно построенную формулу>>). 
Такая формула WFF составляется из кванторов (EXISTS и FORALL), свободных и связанных переменных, литералов, операторов сравнения, логических (булевых) операторов и скобок. 
Каждая свободная переменная, которая встречается в формуле WFF, должна быть также перечислена в списке целевых элементов.

\subsubsection*{Синтаксис исчисления кортежей}

\begin{itemize}[label*=--]
	\item \texttt{объявление-кортежной-переменной ::= RANGE OF переменная IS список-областей};
	\item \texttt{область ::= отношение | реляционное-выражение};
	\item \texttt{реляционное-выражение ::= (список-целевых-элементов)[WHERE wff]}
	\item \texttt{целевой-элемент ::= переменная | переменная.атрибут [AS атрибут]}

\clearpage

	\item \texttt{wff ::= условие | NOT wff | условие AND wff |условие OR wff | IF условие THEN wff | EXISTS переменная (wff) | \\ FORALL переменная (wff) | (wff)}
	\item \texttt{условие ::= (wff) | компаранд операция-отношения компаранд}
\end{itemize}

Если f и g - формулы WFF, то выражение логической импликации \texttt{IF f TНEN g} также будет формулой WFF с семантикой, идентичной семантике формулы \texttt{(NOT f) OR g}

\subsubsection*{Вычислительные возможности исчисления кортежей}

\texttt{aggregate\_function ( expression [, attribute ])}
где

\begin{itemize}[label*=--]
	\item \texttt{aggregate\_function} --- это COUNТ, SUM, AVG, МАХ или МIN (возможны, конечно, и некоторые другие функции);
	\item \texttt{expression} --- это выражение исчисления кортежей (вычисляющее отношение);
	\item \texttt{attribute} --- это такой атрибут результирующего отношения, по которому подсчитывается итог.
\end{itemize}
